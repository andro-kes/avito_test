# Конфигурация линтера

Проект использует [golangci-lint](https://golangci-lint.run/) для статического анализа кода.

## Установка

Линтер устанавливается автоматически при выполнении `make lint` или `make lint-fix`. 

Для ручной установки:

```bash
# Linux/macOS
curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.55.2

# Windows (PowerShell)
iwr -useb https://raw.githubusercontent.com/golangci/golangci-lint/master/install.ps1 | iex
```

## Использование

```bash
# Проверить код
make lint

# Исправить ошибки автоматически
make lint-fix

# Или напрямую
golangci-lint run ./...
golangci-lint run --fix ./...
```

## Конфигурация

Конфигурация находится в файле `.golangci.yml` в корне проекта.

### Включенные линтеры

#### Базовые проверки
- **errcheck** - Проверка обработки ошибок
- **gosimple** - Упрощение кода
- **govet** - Статический анализ (go vet)
- **ineffassign** - Неиспользуемые присваивания
- **staticcheck** - Статический анализ
- **typecheck** - Проверка типов
- **unused** - Неиспользуемый код

#### Стиль кода
- **gofmt** - Форматирование кода
- **goimports** - Управление импортами
- **gci** - Сортировка импортов
- **misspell** - Орфографические ошибки

#### Качество кода
- **gocritic** - Критический анализ кода
- **gocyclo** - Цикломатическая сложность (макс. 15)
- **gosec** - Проверка безопасности
- **dupl** - Дублирование кода

#### Документация
- **godot** - Точки в комментариях
- **godox** - TODO/FIXME комментарии

#### Производительность
- **prealloc** - Предварительное выделение памяти

### Основные правила

1. **Обработка ошибок**: Все ошибки должны быть обработаны явно
2. **Цикломатическая сложность**: Максимум 15 для функций
3. **Безопасность**: Проверка потенциальных уязвимостей
4. **Документация**: Экспортируемые функции должны иметь комментарии
5. **Импорты**: Автоматическая сортировка и группировка

### Исключения

- **Тестовые файлы** (`*_test.go`): Более мягкие правила для `errcheck`, `gosec`, `dupl`
- **Миграции**: Полностью исключены из проверки
- **Неиспользуемые импорты**: Игнорируются для библиотек логирования (zap)

### Настройка под проект

Если нужно изменить правила:

1. Отредактируйте `.golangci.yml`
2. Проверьте изменения: `make lint`
3. Зафиксируйте изменения в git

### Примеры исправления ошибок

#### Обработка ошибок
```go
// Плохо
result, _ := someFunction()

// Хорошо
result, err := someFunction()
if err != nil {
    return err
}
```

#### Неиспользуемый код
```go
// Плохо
var unusedVar int

// Хорошо - удалить или использовать
```

#### Сложность функций
```go
// Плохо - функция слишком сложная
func complexFunction() {
    // 20+ условий и циклов
}

// Хорошо - разбить на несколько функций
func complexFunction() {
    step1()
    step2()
    step3()
}
```

## Интеграция с CI/CD

Линтер автоматически запускается в CI/CD пайплайне. Для локальной проверки перед коммитом:

```bash
make lint
```

## Дополнительные ресурсы

- [Документация golangci-lint](https://golangci-lint.run/)
- [Список всех линтеров](https://golangci-lint.run/usage/linters/)
- [Настройка конфигурации](https://golangci-lint.run/usage/configuration/)

